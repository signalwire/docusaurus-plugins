# CLI Commands

The plugin provides CLI commands for standalone operation and cleanup.

## Generate Command

```bash
npx docusaurus llms-txt [siteDir]
```

Generates `llms.txt` and markdown files using cached routes from a previous build.

### Arguments

- `siteDir` (optional) - Path to your Docusaurus site directory. Defaults to current working directory.

### Prerequisites

**Important:** You must run `npm run build` first to create the route cache.

The CLI command depends on cached route information from Docusaurus builds. Without this cache, the command will fail with "No cached routes found."

### Examples

```bash
# Generate in current directory
npx docusaurus llms-txt

# Generate for specific site directory
npx docusaurus llms-txt ./my-docs-site

# Generate using absolute path
npx docusaurus llms-txt /home/user/projects/docs
```

### How It Works

1. **Loads cached route information** from the previous build
2. **Validates configuration** hasn't changed significantly
3. **Processes routes** using the current plugin configuration
4. **Generates output files** in the build directory

### When to Use

- **Separate build steps**: You want to regenerate llms.txt without rebuilding the entire site
- **CI/CD pipelines**: Separate documentation generation from site building
- **Manual control**: You have `runOnPostBuild: false` configured
- **Development workflow**: Quick regeneration during development

### Typical Workflow

```bash
# 1. Build your Docusaurus site (creates route cache)
npm run build

# 2. Generate documentation files
npx docusaurus llms-txt

# 3. Files are created in build/ directory
ls build/llms.txt build/docs/
```

### Configuration Impact

The generate command uses your current plugin configuration from `docusaurus.config.js`. Changes to configuration will affect the output even when using cached routes.

**Configuration changes that trigger regeneration:**
- Section definitions
- Content selectors
- File generation options
- Processing options

**Configuration changes that use cache:**
- Logging levels
- Error handling settings
- UI options (don't affect file generation)

## Clean Command

```bash
npx docusaurus llms-txt-clean [siteDir] [options]
```

Removes all generated markdown files and `llms.txt` using cached file information.

### Arguments

- `siteDir` (optional) - Path to your Docusaurus site directory. Defaults to current working directory.

### Options

- `--clear-cache` - Also clear the plugin cache directory

### Examples

```bash
# Clean generated files but keep cache
npx docusaurus llms-txt-clean

# Clean everything including cache
npx docusaurus llms-txt-clean --clear-cache

# Clean specific directory
npx docusaurus llms-txt-clean ./docs

# Clean with cache clearing for specific directory
npx docusaurus llms-txt-clean ./docs --clear-cache
```

### What Gets Cleaned

**Generated Files:**
- All individual markdown files generated by the plugin
- The `llms.txt` index file
- The `llms-full.txt` file (if generated)

**Cache (with --clear-cache):**
- Route cache entries
- File generation cache
- Configuration validation cache
- The entire plugin cache directory

**Safe Operation:**
- Only removes files that were generated by the plugin
- Uses cached file information to avoid removing user files
- Preserves original source files and Docusaurus build artifacts

### When to Use Clean

**Development:**
- Clear old generated files before regenerating
- Reset state when changing configuration significantly
- Free up disk space during development

**CI/CD:**
- Ensure clean state between builds
- Remove artifacts before archiving
- Reset cache when switching branches

**Troubleshooting:**
- Clear cache when experiencing configuration issues
- Reset when files seem out of sync
- Clean slate for debugging generation problems

## Advanced Usage

### CI/CD Integration

```yaml
# .github/workflows/docs.yml
name: Generate Documentation

on:
  push:
    branches: [main]

jobs:
  docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build Docusaurus site
        run: npm run build

      - name: Generate llms.txt
        run: npx docusaurus llms-txt

      - name: Upload documentation
        uses: actions/upload-artifact@v3
        with:
          name: documentation
          path: |
            build/llms.txt
            build/llms-full.txt
            build/docs/**/*.md
```

### Development Workflow

```bash
# Development script in package.json
{
  "scripts": {
    "docs:build": "docusaurus build",
    "docs:generate": "docusaurus llms-txt",
    "docs:clean": "docusaurus llms-txt-clean",
    "docs:fresh": "npm run docs:clean -- --clear-cache && npm run docs:build && npm run docs:generate"
  }
}
```

### Configuration for CLI-Only Usage

```javascript
// docusaurus.config.js
module.exports = {
  plugins: [
    [
      '@signalwire/docusaurus-plugin-llms-txt',
      {
        runOnPostBuild: false,  // Disable automatic generation
        // ... other configuration
      }
    ]
  ]
};
```

This setup gives you complete control over when documentation is generated.

## Troubleshooting CLI Commands

### "No cached routes found"

**Problem:** CLI command fails because route cache doesn't exist.

**Solution:**
1. Run `npm run build` first to create the cache
2. Verify the build completed successfully
3. Check that the plugin is properly configured

### "Configuration validation failed"

**Problem:** Current configuration is incompatible with cached routes.

**Solutions:**
1. Run a fresh build: `npm run build`
2. Clear cache: `npx docusaurus llms-txt-clean --clear-cache`
3. Check for configuration errors in `docusaurus.config.js`

### "Permission denied" errors

**Problem:** CLI command can't write to output directory.

**Solutions:**
1. Check file permissions on the build directory
2. Run with appropriate permissions
3. Ensure the output directory exists and is writable

### Generated files not appearing

**Problem:** CLI command runs without error but files aren't created.

**Debugging:**
1. Check if routes are being processed: use verbose logging
2. Verify output directory is correct
3. Check for content extraction issues
4. Review include/exclude configuration

### Performance issues with large sites

**Problem:** CLI command is slow or uses too much memory.

**Optimizations:**
1. Use `excludeRoutes` to skip unnecessary content
2. Set `includeVersionedDocs: false` if not needed
3. Disable individual markdown files: `enableMarkdownFiles: false`
4. Reduce logging: `logLevel: 1`

## Command Reference Quick Guide

| Command | Purpose | Prerequisites | Common Options |
|---------|---------|---------------|----------------|
| `docusaurus llms-txt` | Generate documentation | `npm run build` | `[siteDir]` |
| `docusaurus llms-txt-clean` | Clean generated files | None | `--clear-cache` |

**Remember:** Always run `npm run build` before using the generate command for the first time or after significant configuration changes.